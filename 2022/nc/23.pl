my($t,$Z,$Q,@V)=(0,100,1);my@M=map{chomp;[('.')x$Z,(split//),('.')x$Z]}<>;
my$W=@{$M[0]};unshift@M,[('.')x$W]for 1..$Z;push@M,[('.')x$W]for 1..$Z;my$H=@M;
my@D=([-1,0,'$',224],[1,0,'%',7],[0,-1,'&',148],[0,1,'*',41]);my%M=map{$_->[2],$_}@D;my%F=map{$_=>1}qw(.12);
for my$y($Z..$H-$Z){($M[$y][$_]eq'#')&&(push @V,[$_,$y])for$Z..$W-$Z;
while($Q){for(@V){my($x,$y)=@{$_};next unless my$s=
($M[$y+1][$x+1]lt'+')+2*($M[$y+1][$x]lt'+')+4*($M[$y+1][$x-1]lt'+')+8*($M[$y][$x+1]lt'+')
+16*($M[$y][$x-1]lt'+')+32*($M[$y-1][$x+1]lt'+')+64*($M[$y-1][$x]lt'+')+128*($M[$y-1][$x-1]lt'+');
for(@D){my($d,$e,$v,$w)=@{$_};unless($w&$s){($M[$y][$x],$M[$y+$d][$x+$e])=($v,$M[$y+$d][$x+$e]ne'1'?1:2);last}}}
$Q=0;for(0..$#V){my($x,$y)=@{$V[$_]};next if$M[$y][$x]eq'#';my($X,$Y)=($x+$M{$M[$y][$x]}[1],$y+$M{$M[$y][$x]}[0]);
if($M[$Y][$X]ne'1'){($M[$Y][$X],$M[$y][$x])=('.','#');next}$Q=1;($M[$Y][$X],$M[$y][$x])=('#','.');$V[$_]=[$X,$Y]}
if(++$t==10){my($r,$b,$l,$z)=(0,0,$W,$H);for(@V){$l=$_->[0]if$_->[0]<$l;$b=$_->[1]if$_->[1]>$b;
$r=$_->[0]if$_->[0]>$r;$z=$_->[1]if$_->[1]<$z}say-@V+(1+$b-$z)*($r-$l+1)}push@D,shift@D}say$t
