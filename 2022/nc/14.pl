my($n,$t,$y,$x,$z,@m)=(0,0);
for(<>) {
  my($s,@p)=map{[split/,/]}split/ -> /;
  $m[$z=$s->[1]][$s=$s->[0]]='#';
  for(@p){
    ($x,$y)=($_->[0]<=>$s,$_->[1]<=>$z);
    $m[$z+=$y][$s+=$x]='#' while $s!=$_->[0]||$z!=$_->[1]
  }
}
push @m,[],[('#')x(503+($z=$#m))];

while(1) {
  last if $m[$y=0][$x=500];
  while(1){
    $n||=$t if (++$y)>$z;
    $m[$y][$x]&&($m[$y][$x-1]?$m[$y][$x+1]?($m[$y-1][$x]='o',$t++,last):$x++:$x--)
  }
}
say "$n\n$t"
