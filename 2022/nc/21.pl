my($t,$z,@res)=(0,0);

my%fn=(
'+'=>[sub{$_[0]+$_[1]},sub{$_[0]-$_[1]},sub{$_[0]-$_[1]}],
'-'=>[sub{$_[0]-$_[1]},sub{$_[0]+$_[1]},sub{$_[1]-$_[0]}],
'/'=>[sub{$_[0]/$_[1]},sub{$_[0]*$_[1]},sub{$_[1]/$_[0]}],
'*'=>[sub{$_[0]*$_[1]},sub{$_[0]/$_[1]},sub{$_[0]/$_[1]}],
'X'=>[sub{[]}],
);
my%p=map{chomp,my@t=split/:? /;$t[0],@t>2?[@t[1..3]]:$t[1]}<>;
say e('root');
($p{'humn'},$p{'root'}[1])=([0,'X',0],'-'); $z=e('root');
($t,$z)=($fn{$z->[1]}[ref$z->[0]?1:2]($t,$z->[ref$z->[0]?2:0]),$z->[ref$z->[0]?0:2])while$z&&@$z;
say$t;

sub e{my($l,$x,$r)=@{$p{$_[0]}};
($l,$r)=map{ref$p{$_}?e($_):$p{$_}} $l,$r;
(ref$l||ref$r)?[$l,$x,$r]:$fn{$x}[0]($l,$r);}

